%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%
%% 情報通信システム工学科 卒業論文テンプレート
%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\documentclass[11pt]{icsthesis}
\usepackage[dvipdfmx]{graphicx}
\usepackage[fleqn]{amsmath}
\usepackage{fancyhdr}
\usepackage{bm}
\usepackage{bigstrut}
\usepackage{multirow}
\usepackage{amsfonts}

%%----------------------------------------------------------------------------------------------------------------------
%% 表紙の記載事項
%%----------------------------------------------------------------------------------------------------------------------
%% ToDo: 論文タイトル
\title{DTNを用いた効率的メッセージ交換に関する研究}
%% ToDo: 著者一覧
\authorA{21A5041}{記内　勇太}
\authorB{21A5101}{古山　孔亮}
%\authorC{21A5003}{氏　名3}
%\authorD{21A5004}{氏　名4}

%% ToDo: 指導教員
\supervisor{菅原　真司 教授}

%% ToDo: 提出日
\date{令和7年1月30日}

%%----------------------------------------------------------------------------------------------------------------------
\begin{document}
\maketitle
%-----------------------------------------------------------
% ヘッダ・フッタ設定
\pagestyle{fancy}
\fancyhead[R]{\nouppercase{\fontsize{10.5pt}{0pt}\selectfont\rightmark}}
\fancyhead[L]{\nouppercase{\fontsize{10.5pt}{0pt}\selectfont\leftmark}}
%\fancyhead[R]{\nouppercase{\small\rightmark}}
%\fancyhead[L]{\nouppercase{\small\leftmark}}
\fancyfoot[C]{--\ \thepage\ --}
\renewcommand{\headrulewidth}{0.3truemm}
%-----------------------------------------------------------
%% 目次
\pagenumbering{roman}
\setcounter{tocdepth}{4}
\pagestyle{fancy}
\fancyfoot[C]{--\ \thepage\ --}
{\makeatletter
\let\ps@jpl@in\ps@empty
\makeatother
\pagestyle{plain}
\tableofcontents
\clearpage}
\pagenumbering{arabic}
%%======================================================================================================================
%% ここから本文 ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
%%======================================================================================================================

%%=============第１章=============
\chapter{まえがき}
\section{研究背景}
近年，インターネットは，情報交換・共有システムとして，社会・経済のインフラストラクチャの役割を担っている．しかし，全ての地域に高度な通信サービスを提供することは，コストが掛かる上に周波数の有限性から現実的ではない．また，ディジタルデバイド地域のインフラ構築や災害時などで本来の通信インフラの機能や性能が低下・停止した場合を考え，場所・時間を問わず利用できる情報サービスの実現が必要とされている．

そこで，従来では想定されていなかった環境を含むエンドツーエンドの情報伝達において，従来のTCP/IP（Transmission Control Protocol/Internet Protocol）技術を拡張し，中継ノード及びエンドノードの機能を再設計する必要がある．昔から車や人などが物理的に情報を運ぶやり方は存在していた．それらをTCP/IP技術の問題認識から発生した技術領域としてインターネット通信の枠組みで考えられたのが，DTNである．

TCP/IP技術におけるDTNの概念はビントン・サーフ氏によって提案され，惑星間インターネットの構築が基になっている．その惑星間インターネットには2つの大きな問題点が挙げられる．まず，惑星間というのは光速で進む電波であっても，届くのに長い時間を要する．次に，通信機が惑星によって見えなくなり，その間，通信が途絶える．これらの問題をそれぞれ，「通信遅延」，「通信途絶」として研究されてきた[2]．

DTNの特徴的な技術として，蓄積運搬形転送がある．これは，再開を待つ，あるいは最適なタイミングを待つための一時的「蓄積」と，物理的に車や列車を用いて情報を運ぶ「運搬」を用いる必要がある[1]．現在では，カーナビにおいてネットワークを活用した高度交通システム（ITS：Inteligent Transport Systems）の普及が急速に進んでおり，ITSにおける研究として，車々間アドック通信（VANET：Vehicular Adhoc Network）に関する研究が活発に行われている[3]．そのような人や車等における蓄積運搬形転送の中で，疎密度モバイルアドホック網における感染形中継転送方式（Epidemic Routing）が確率的中継転送方式の最も代表的な方式として存在する．Epidemic Routingでは，メッセージを保持する端末が他の端末と通信可能となった際，常に保持しているメッセージの複製を他の端末に送信する．結果的に伝染病のように広がり，いずれかのメッセージが宛先端末に到達することになる．しかし，Epidemic Routingではメッセージの到達を引き換えに，端末のバッファや網内に多くの複製メッセージが残存してしまう．そのため，Recovery Scheme（回復手法）やAnti Packet（除去パケット）を使用したルーティング手法などが提案されてきた[1]．

本研究では，DTN環境において，メッセージやバッファ等の資源を効率良く管理を行えば，必然的にメッセージは宛先に届けやすくなるのではないかと考えた．実験においては，「メッセージ到達率」，「メッセージ平均待ち時間」，「メッセージ削除数」に着目して，ネットワーク負荷の削減・効率的なメッセージ転送の実現を目指す．

%%=============第２章=============
\chapter{DTNにおける従来手法とその問題}
\section{DTN}
DTNとは，Delay，Disruption，Disconnection Tolerant Networkingの略で，大きな遅延や通信途絶，繋がっていない状態の方が多い環境においても，適切な情報通信を現実的なコストで実現できる技術であり，中継転送を利用することにより，エンドツーエンドの通信を可能とする．[5]要素技術として，バンドルプロトコルとストアアンドフォワード方式が存在する．インターネットでのデータ転送にはトランスポート層のTCPを使用するが，通信に遅延や切断が生じると，通信品質が劣化してしまう．そのため，TCPによる通信では，エンドツーエンドのリンクが安定している必要がある．DTNでは，不安定なリンクにも対応しなければならないため，トランスポート層の上に「バンドル」と呼ばれるプロトコルを乗せることで劣通信環境に対応する．バンドルプロトコルの中でも，データ転送にはストアアンドフォワード方式を用いる[4]．ストアアンドフォワード方式は，通信が不可能な状態である時にデータを蓄積し，通信が可能な状態である時にデータを転送する方式である[1]．

\section{Epidemic Routing}
蓄積運搬形転送に基づく最も初期に提案された手法に，感染形中継転送方式であるEpidemic Routingと呼ばれる手法が存在する．メッセージを保持する端末が他の端末と接触をすることで通信を行い，複製メッセージを拡散させながら網内の末端までメッセージを届けることを可能にし，いずれかのメッセージが宛先端末に到達する．この手法は，網資源がある場合には，あらゆる方式の中で最も優れた遅延性能を示す[1]．

しかし，問題点として，受信端末は複製メッセージをさらに複製するため，網資源を最も消費してしまう欠点がある．よって，拡散させることに重きを置いているため，効率の良いルーティングとは言い難い．

\begin{figure}[h]
\centering
\includegraphics[width=120mm]{figures/EpidemicRouting_method.png}
\caption[]{\it{Epidemic Routing}}
\end{figure}

\newpage

\section{Recovery Scheme（回復手法）}
Epidemic Routingでは，メッセージが宛先に到達した後，メッセージの複製により網内に到達したメッセージが残存してしまう可能性がある．そのためにRecovery Schemeが提案された．この手法では，メッセージが到達した宛先ノードが，到達した事を知らせるためにメッセージのIDを載せたAnti-Paketを生成する．これにより，Anti-Paketを受信したノードは，該当するメッセージを削除することで，到達したメッセージの複製を抑制する[6]．

\begin{figure}[h]
\centering
\includegraphics[width=120mm]{figures/RecoveryScheme_method.png}
\caption[]{\it{Recovery Scheme}}
\end{figure}

\newpage

\section{Spray And Wait}
Spray And Waitは，メッセージ毎に複製回数が静的に設定され，メッセージを複製する度に複製回数が半分に更新される．メッセージは，Spray段階とWait段階の2つに段階を経て転送される[6]．生成元ノードではある整数Lが与えられ，メッセージの複製はそれぞれForward tokenと呼ばれる整数値nを保持する．生成元ノードではn=Lとなり，転送される度にnが半減し，n=1となった時にWait段階へ移行する．Wait段階では，メッセージの複製は行われず，直接，宛先ノードに接触した時のみメッセージを転送する[7]．複製回数が多すぎるとメッセージの削除が発生し，少なすぎると宛先に到達しない場合がある．

問題点として，ネットワークの大きさやノード数の変化に応じて適切な最大生成数を設定することは困難である[8]．

\begin{figure}[h]
\centering
\includegraphics[width=120mm]{figures/SprayAndWait_method.png}
\caption[]{\it{Spray And Wait}}
\end{figure}

\section{Max Prop}
Max Propは，各ノードが保持しているメッセージに優先度を付け，他ノードと接触時に優先度の高いメッセージから順に複製メッセージを送信し，バッファの容量が不足した時に優先度の低いメッセージから順に破棄する手法である[7]．

%%=============第３章=============
\chapter{提案手法}
\section{Priority Message Router}
Priority Message Router（以下，PMRouter）とは，端末がメッセージに優先度を設け，他ノードと接触したらそのノードのすれ違ったノード履歴より，自身の保有するメッセージの宛先と同一のメッセージを探す．存在した時に，そのメッセージの優先度を向上させ，バッファ内に存在できる時間をコントロールする．優先度の向上したメッセージに対しTTL（メッセージ有効時間）を変更することで，「メッセージ到達率」，「メッセージ平均待ち時間」，「メッセージ削除数」の改善を図る手法である．基本的なメッセージの転送は感染形中継転送方式であり，優先度を設けることから，Epidemic RoutingとMax Propを拡張したものとなる．

\section{PMRouterの構成とアルゴリズム}
PMRouterでは，始めにEpidemic Routingの環境を用意する．そこで，各メッセージに優先度を設けるためのメソッドを追加する（ここまではMax Propと同様）．次に各ノードのすれ違ったノードを格納するためのリストを追加し，自身の保有するメッセージの宛先と比較する．最後に，自身の保有するメッセージの宛先が他ノードのすれ違ったノードのリストに存在していれば，その宛先メッセージの優先度を向上させ，TTLをコントールする．

%%=============第４章=============
\chapter{評価}
\section{評価方法}
計算機シミュレーションにより，「メッセージ到達率」，「メッセージ平均待ち時間」，「メッセージ削除数」を評価尺度として提案方式の性能を検証する．また，従来手法（Epidemic Routing及びRecovery Scheme）と提案手法の性能を比較し，提案手法の実用性を検証する．

\section{実験環境}
本研究では，The ONEシミュレータ（The Opportunistic Network Environment Simulator）を用いて実験を行う．The ONEシミュレータは，DTNの評価実験をするために作成されたフリーのネットワークシミュレータである．任意のルーティングやモビリティパターンを導入することができる．時間の遷移方式はタイムステップ型であり，標準では0.1秒毎に遷移する．また，通信可能距離と通信速度のみを考慮し，パケットのロスト，建物，電波干渉等による通信範囲の削減，保有メッセージの把握等の細かい部分は考慮していない[2]．このシミュレータではバンドル層以上のみでシミュレーションを行っているため，トランスポート層以下に関わる電波の輻輳や衝突等については，パラメータで妥当な値を設定しなければならない[9]．

\section{条件とシミュレーションパラメータ}
本研究を行う上での条件を以下に示す．
\begin{quote}
 \begin{itemize}
  \item デフォルトマップ（初期状態のThe ONEシミュレータに搭載されている）を用いる．
  \item ノードは歩行者と車に割り振る．
  \item 歩行者には歩くスピードが速い人と遅い人がいることを想定し，それぞれ1.8km/h及び5.4km/hとする．
  \item 車は法定速度の多い40km/h及び60km/hを想定する．
  \item 結果は，固定経路を進むシミュレーション結果の1回分とランダムな経路を進む結果の10回分の平均値をそれぞれ示す．
 \end{itemize}
\end{quote}
本研究を行うためのシミュレーションパラメータを表1に示す．

\begin{table}[h]
    \begin{center}
      \caption[]{シミュレーションパラメータ}
      \label{example:terminology}
      \begin{tabular}{|c|c|}
        \hline
        移動モデル & MapBasedMovement\\
        \hline
        シミュレーション時間 & 43200秒\\
        \hline
        試行回数 & 10回\\
        \hline
        ノード数 & 100，300，500\\
        \hline
        TTL & 300，720 [分]\\
        \hline
        優先TTL & 100 [分]\\
        \hline
        ノードの移動速度（人） & 1.8，5.4 [km/h]\\
        \hline
        ノードの移動速度（車） & 39.96，59.94 [km/h]\\
        \hline
        発行メッセージ数 & 1460\\
        \hline
        通信速度 & 250[kbps]\\
        \hline
        通信可能距離 & 10 [m]\\
        \hline
        端末バッファ容量 & 50 [MBytes]\\
        \hline
      \end{tabular}
    \end{center}
\end{table}

%%=============第４章=============
\chapter{結論}



%%======================================================================================================================
%% ここまで本文 ::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::::
%%======================================================================================================================

%% 謝辞
\clearpage
\fancyhead[L]{}\fancyhead[R]{}
\renewcommand{\headrulewidth}{0truemm}
\section*{謝辞}
本研究を遂行し，卒業論文をまとめるにあたって，ご指導ならびにご助言して頂き，研究室活動全般にわたってお世話になりました菅原真司教授に感謝致します．

%%----------------------------------------------------------------------------------------------------------------------
%% 参考文献
\clearpage
\nocite{*}
\bibliographystyle{icsthesis}
\fancyhead[L]{\nouppercase{\small\leftmark}}\fancyhead[R]{}
\renewcommand{\headrulewidth}{0.3truemm}
\bibliography{thesis}

%%----------------------------------------------------------------------------------------------------------------------
%% 付録： 不要なら，最後の \end{document} を残して，これ以降の行を消す．
%%
\clearpage
\fancyhead[L]{\nouppercase{\small\leftmark}}
\fancyhead[R]{\nouppercase{\small\rightmark}}
\fancyfoot[C]{--\ \thepage\ --}
\renewcommand{\headrulewidth}{0.3truemm}
\appendix
\chapter{マップについて}
今回の実験では、シミュレータに搭載されていたヘルシンキのマップに加えて、自作の完全グラフのマップでの実験を行った．研究開始当初は参考文献に倣い、他の実在するマップでの実験を行う予定であったが、マップ導入時の問題を解決することができなかったため、断念した．\\\\
ここでは、マップの導入に関して行った手順について記す．
%ここは「付録章」である．\textsf{\yen appendix}以降に，\textsf{\yen chapter\{見出し文字列\}}と書けば，
%「付録章見出し」が設定される．
%「章見出し」と同じ文字サイズ，同じ上下余白である．

\section{osmファイルからwktファイルへの変換}



\subsection{osmファイル}
%ここは，「付録小小節」である．\textsf{\yen appendix}以降に\textsf{\yen subsubsection\{見出し文字列\}}と書けば，
%「付録小小節見出し」が設定される．
%「小小節見出し」と同じ文字サイズ，同じ上下余白である．
osm ファイルとは，オープンストリートマップという自由に利用でき，共同編集機能のある世界地図を
作成する共同作業プロジェクト(参考文献OSM)にてエクスポートすることができるファイル形式である．osmファイルの
状態では，TheONEシミュレータで用いることができない．
\subsection{wktファイル}
wktファイルとは、地理情報をテキスト形式で表現するファイル形式である．TheONEシミュレータで読み込めるマップの形式はwktファイルのみであるため、osmファイルは何らかの形でwktファイルに変更する必要がある．
\section{osmファイルとwktファイル}

\subsection{OpenJUMPを用いたosmファイルからwktファイルへの変換}
参考文献に倣いOpenJUMPというソフトを用いてosmファイルからwktファイルへの変換を行う．OpenJUMP とは，ユーザが地理データを表示したり編集したりすることが出るGIS(地理情報システム)
である．osmファイルをOpenJUMPで開くと図\ref{}のようになり，ここから様々なノードなどの編集が
できる．しかし、この方法は動作環境によってはOpenJUMP上でosmファイルを開くことができないという現象が確認できた．
\subsection{QGISを用いたosmファイルからwktファイルへの変換}
上記の問題を解決するため、QGISという別のソフトを用いる。QGIS とはGNU General Public License で提供されている，OpenJUMP と同じGIS(地理情報システ
ム) であり，OpenJUMPと比べて多くの機能が備えられている．osmファイルに対応しており，このソフ
トを用いてosmファイルをshpファイルに変換する．osmファイルを別のファイル形式に変換後、そのファイルを改めてOpenJUMP上で開くことで、wktファイルへの変換を行った．
\section{マップ導入時の問題}
上記の二つのどちらの場合でも、OpenJUMPにファイルを読み込んだ際、マップの縮尺が極端に小さくなってしまった．TheONEシミュレータに導入した際も、極端に小さくなった状態で実行されてしまうため、正しい結果が得られなくなってしまった．この問題を解決することができなかったため、実在するマップでの実験を断念した．
\end{document}
